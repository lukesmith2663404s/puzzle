<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Puzzle Challenge</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    .hidden { display: none; }
    .code-input {
      display: flex;
      justify-content: center;
      margin-top: 50px;
    }
    .code-input input {
      width: 40px;
      height: 40px;
      margin: 5px;
      font-size: 24px;
      text-align: center;
      background: #222;
      color: #fff;
      border: 2px solid #555;
    }
    .grid {
      display: grid;
      margin: 20px auto;
      gap: 2px;
    }
    .cell {
      width: 60px;
      height: 60px;
      background: #222;
      font-size: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .outer-ring {
      cursor: pointer;
    }
    .crossword {
      display: grid;
      grid-template-columns: repeat(5, 50px);
      grid-template-rows: repeat(5, 50px);
      gap: 2px;
      justify-content: center;
      margin-top: 40px;
    }
    .cw-cell {
      position: relative;
      background: #fff;
      color: #000;
    }
    .cw-cell input {
      width: 100%;
      height: 100%;
      border: none;
      text-align: center;
      font-size: 20px;
      text-transform: uppercase;
      background: transparent;
      color: #000;
    }
    .cw-number {
      position: absolute;
      top: 2px;
      left: 2px;
      font-size: 10px;
    }
    .black-cell {
      background: #000;
    }
    .clock {
      font-size: 48px;
      margin: 20px 0;
    }
    .connect4-board {
      display: grid;
      grid-template-columns: repeat(7, 60px);
      grid-template-rows: repeat(6, 60px);
      gap: 2px;
      justify-content: center;
      margin: 20px auto;
    }
    .c4-cell {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: #222;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
    }
    .haha {
      margin-top: 10px;
      color: red;
      opacity: 0;
      transition: opacity 1s;
    }
  </style>
</head>
<body>
  <!-- Puzzle 0 -->
  <div id="codeEntry">
    <div class="code-input">
      <input maxlength="1">
      <input maxlength="1">
      <input maxlength="1">
      <input maxlength="1">
      <input maxlength="1">
    </div>
  </div>

  <!-- Puzzle 1 -->
  <div id="puzzle1" class="hidden">
    <h2>Puzzle 1</h2>
    <div id="ticTacToe"></div>
    <div id="p1Status"></div>
    <button id="p1Next" class="hidden">Next</button>
  </div>

  <!-- Puzzle 2 -->
  <div id="puzzle2" class="hidden">
    <h2>Puzzle 2</h2>
    <div class="crossword" id="crossword"></div>
    <button id="p2Next" class="hidden">Next</button>
    <div id="clues">
      <h3>ACROSS</h3>
      <p>1A. 2F Lecturers</p>
      <p>5A. With 8A ...</p>
      <p>6A. What e = 2?</p>
      <p>8A. See 5A</p>
      <p>10A. Donned on body parts...</p>
      <h3>DOWN</h3>
      <p>1D. Fastened bands...</p>
      <p>2D. George and Ruthie's...</p>
      <p>3D. The beginning of knowledge...</p>
      <p>4D. What does a sender do?</p>
      <p>7D. You might well say this...</p>
      <p>9D. So you want to know 9D?... </p>
    </div>
  </div>

  <!-- Puzzle 3 -->
  <div id="puzzle3" class="hidden">
    <h2>Puzzle 3</h2>
    <div id="clock" class="clock"></div>
    <button id="primeBtn">Prime Time?</button>
    <div id="primeMsg"></div>
    <button id="p3Next" class="hidden">Next</button>
  </div>

  <!-- Puzzle 4 -->
  <div id="puzzle4" class="hidden">
    <h2>Puzzle 4</h2>
    <div class="connect4-board" id="c4Board"></div>
    <button id="c4Reset">Reset</button>
    <div id="haha" class="haha">haha</div>
    <button id="p4Next" class="hidden">Next</button>
  </div>

  <!-- Puzzle 5 -->
  <div id="puzzle5" class="hidden">
    <h2>Puzzle 5 Placeholder</h2>
  </div>

<script>
/* ---------------- Puzzle 0: Code Entry ---------------- */
const codeInputs = document.querySelectorAll('#codeEntry input');
codeInputs.forEach((input, idx) => {
  input.addEventListener('input', () => {
    if (input.value.length === 1 && idx < codeInputs.length - 1) {
      codeInputs[idx+1].focus();
    }
    if ([...codeInputs].map(i=>i.value.toUpperCase()).join('') === "JONES") {
      document.getElementById("codeEntry").classList.add("hidden");
      document.getElementById("puzzle1").classList.remove("hidden");
      startTicTacToe();
    }
  });
});

/* ---------------- Puzzle 1: TicTacToe ---------------- */
function startTicTacToe() {
  const boardEl = document.getElementById("ticTacToe");
  const statusEl = document.getElementById("p1Status");
  const nextBtn = document.getElementById("p1Next");
  boardEl.innerHTML = "";
  statusEl.innerHTML = "";
  nextBtn.classList.add("hidden");
  let board = Array(5).fill(null).map(()=>Array(5).fill(""));
  let gameOver = false;
  let outerActive = false;

  boardEl.style.gridTemplateColumns = "repeat(5,60px)";
  boardEl.style.gridTemplateRows = "repeat(5,60px)";
  for (let r=0;r<5;r++){
    for (let c=0;c<5;c++){
      const cell=document.createElement("div");
      cell.classList.add("cell");
      if (r>0&&r<4&&c>0&&c<4){
        cell.dataset.inner=true;
      } else {
        cell.dataset.outer=true;
        cell.style.background="#000";
      }
      cell.addEventListener("click",()=>{
        if (gameOver) {
          if (outerActive && cell.dataset.outer && cell.textContent==="") {
            cell.textContent="O";
            if (checkWin("O")) {
              statusEl.textContent="You Win!";
              nextBtn.classList.remove("hidden");
            }
          }
          return;
        }
        if (cell.dataset.inner && cell.textContent==="") {
          cell.textContent="O";
          board[r][c]="O";
          if (checkWin("O")) {
            statusEl.textContent="You Win!";
            gameOver=true; nextBtn.classList.remove("hidden");
            return;
          }
          cpuMove();
          if (checkWin("X")) {
            statusEl.textContent="You Lose!";
            gameOver=true; outerActive=true;
            return;
          }
          if (isFull()) {
            statusEl.textContent="Tie!";
            gameOver=true; outerActive=true;
          }
        }
      });
      boardEl.appendChild(cell);
    }
  }
  function cpuMove() {
    for (let r=0;r<5;r++)for(let c=0;c<5;c++){ if(r===2&&c===2){ if(board[r][c]===""){ board[r][c]="X"; boardEl.children[r*5+c].textContent="X"; return;}}}
    for (let r=0;r<5;r++)for(let c=0;c<5;c++){ if(r>0&&r<4&&c>0&&c<4&&board[r][c]===""){ board[r][c]="X"; boardEl.children[r*5+c].textContent="X"; return;}}
  }
  function checkWin(p){
    const lines=[];
    for(let i=1;i<=3;i++){lines.push([[1,i],[2,i],[3,i]]);lines.push([[i,1],[i,2],[i,3]]);}
    lines.push([[1,1],[2,2],[3,3]],[[1,3],[2,2],[3,1]]);
    return lines.some(line=>line.every(([r,c])=>board[r][c]===p));
  }
  function isFull(){return [1,2,3].every(r=>[1,2,3].every(c=>board[r][c]!==""));}
  cpuMove();
  document.getElementById("p1Next").onclick=()=>{document.getElementById("puzzle1").classList.add("hidden");document.getElementById("puzzle2").classList.remove("hidden");startCrossword();};
}

/* ---------------- Puzzle 2: Crossword ---------------- */
function startCrossword(){
  const grid=document.getElementById("crossword"); grid.innerHTML="";
  const ans=["BELKS","E*ONE","LOG*N","THIRD","SOCKS"];
  for(let r=0;r<5;r++){for(let c=0;c<5;c++){
    const ch=ans[r][c]; const cell=document.createElement("div");
    if(ch==="*"){cell.classList.add("black-cell");} else {
      cell.classList.add("cw-cell");const inp=document.createElement("input");inp.maxLength=1;
      inp.addEventListener("input",checkSolution);cell.appendChild(inp);
    }
    grid.appendChild(cell);
  }}
  function checkSolution(){
    let correct=true; let cells=grid.querySelectorAll(".cw-cell input");
    let idx=0; for(let r=0;r<5;r++){for(let c=0;c<5;c++){if(ans[r][c]!=="*"){ if(cells[idx].value.toUpperCase()!==ans[r][c]) correct=false; idx++; }}}
    if(correct) document.getElementById("p2Next").classList.remove("hidden");
  }
  document.getElementById("p2Next").onclick=()=>{document.getElementById("puzzle2").classList.add("hidden");document.getElementById("puzzle3").classList.remove("hidden");startClock();};
}

/* ---------------- Puzzle 3: Prime Time ---------------- */
function startClock(){
  const clock=document.getElementById("clock");const btn=document.getElementById("primeBtn");
  const msg=document.getElementById("primeMsg");const next=document.getElementById("p3Next");
  function update(){const d=new Date();clock.textContent=d.getHours().toString().padStart(2,"0")+" : "+d.getMinutes().toString().padStart(2,"0");}
  setInterval(update,1000);update();
  btn.onclick=()=>{
    // Testing bypass
    // Uncomment below block to re-enable real prime check
    /*
    const primes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59];
    const d=new Date();let h=d.getHours(),m=d.getMinutes();
    let errs=[];if(!primes.includes(h)) errs.push(h+" isn't prime");if(!primes.includes(m)) errs.push(m+" isn't prime");
    if(errs.length){msg.textContent=errs.join(" and ");return;}
    */
    next.classList.remove("hidden");
  };
  next.onclick=()=>{document.getElementById("puzzle3").classList.add("hidden");document.getElementById("puzzle4").classList.remove("hidden");startConnect4();};
}

/* ---------------- Puzzle 4: Connect 4 ---------------- */
function startConnect4(){
  const boardEl=document.getElementById("c4Board");const reset=document.getElementById("c4Reset");
  const next=document.getElementById("p4Next");const haha=document.getElementById("haha");
  let board;let gameOver=false;let cheatCount=0;const maxCheats=3;
  function init(){board=Array(6).fill(null).map(()=>Array(7).fill(""));boardEl.innerHTML="";gameOver=false;cheatCount=0;next.classList.add("hidden");
    for(let r=0;r<6;r++){for(let c=0;c<7;c++){const cell=document.createElement("div");cell.classList.add("c4-cell");
      cell.addEventListener("click",()=>{if(!gameOver) playerMove(c);});boardEl.appendChild(cell);}}
    cpuMove();}
  function render(){for(let r=0;r<6;r++){for(let c=0;c<7;c++){const idx=r*7+c;boardEl.children[idx].textContent=board[r][c];}}}
  function drop(col,p){for(let r=5;r>=0;r--){if(board[r][col]===""){board[r][col]=p;return true;}}return false;}
  function checkWin(p){for(let r=0;r<6;r++){for(let c=0;c<7;c++){if(c+3<7&&[0,1,2,3].every(i=>board[r][c+i]===p))return true;if(r+3<6&&[0,1,2,3].every(i=>board[r+i][c]===p))return true;if(c+3<7&&r+3<6&&[0,1,2,3].every(i=>board[r+i][c+i]===p))return true;if(c-3>=0&&r+3<6&&[0,1,2,3].every(i=>board[r+i][c-i]===p))return true;}}return false;}
  function playerMove(col){if(drop(col,"O")){render();if(checkWin("O")){gameOver=true;next.classList.remove("hidden");}else cpuMove();}}
  function cpuMove(){if(gameOver)return;
    drop(Math.floor(Math.random()*7),"X");render();
    if(Math.random()<0.1 && cheatCount<maxCheats){cheatCount++;setTimeout(()=>{drop(Math.floor(Math.random()*7),"X");render();},200);haha.style.opacity=1;setTimeout(()=>{haha.style.opacity=0;},1000);}
    if(checkWin("X"))gameOver=true;}
  reset.onclick=init;init();
}
</script>
</body>
</html>
