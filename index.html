<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Puzzle Sequence</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    .hidden { display: none; }
    .code-input { width: 2em; text-align: center; font-size: 2em; margin: 0.2em; }
    .grid, .crossword { margin: 20px auto; }
    .cell {
      width: 60px; height: 60px;
      border: 1px solid #555; display: inline-flex;
      align-items: center; justify-content: center;
      font-size: 2em; cursor: pointer;
    }
    .outer { border: none; cursor: pointer; }
    .crossword { display: grid; grid-template-columns: repeat(5, 50px); grid-template-rows: repeat(5, 50px); gap: 2px; }
    .cw-cell { position: relative; background: #fff; color: #000; font-size: 1.2em; text-transform: uppercase; text-align: center; }
    .cw-cell input { width: 100%; height: 100%; border: none; text-align: center; font-size: 1.2em; text-transform: uppercase; background: transparent; }
    .cw-number { position: absolute; top: 2px; left: 2px; font-size: 0.5em; }
    .cw-block { background: #000; }
    .next-btn { margin: 20px; padding: 10px 20px; font-size: 1em; cursor: pointer; }
    .clock { font-size: 3em; margin: 20px; }
    #primeMessage { margin: 10px; color: red; }
    #connect4 { margin: 20px auto; }
    #connect4-board { display: grid; grid-template-columns: repeat(7, 60px); grid-template-rows: repeat(6, 60px); gap: 5px; justify-content: center; }
    .c4-cell { width: 60px; height: 60px; border-radius: 50%; background: #222; display: flex; align-items: center; justify-content: center; }
    .c4-red { background: red; }
    .c4-yellow { background: yellow; }
    #haha { opacity: 0; transition: opacity 0.5s; color: magenta; font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <!-- Code Entry -->
  <div id="codeEntry">
    <input maxlength="1" class="code-input" id="c1">
    <input maxlength="1" class="code-input" id="c2">
    <input maxlength="1" class="code-input" id="c3">
    <input maxlength="1" class="code-input" id="c4">
    <input maxlength="1" class="code-input" id="c5">
  </div>

  <!-- Puzzle 1 -->
  <div id="puzzle1" class="hidden">
    <div id="grid"></div>
    <div id="message"></div>
    <button id="reset1">Reset</button>
    <button id="next1" class="next-btn hidden">Next</button>
  </div>

  <!-- Puzzle 2 -->
  <div id="puzzle2" class="hidden">
    <div style="margin-top:30px;"></div>
    <div id="crossword" class="crossword"></div>
    <button id="next2" class="next-btn hidden">Next</button>
    <div id="clues">
      <h3>ACROSS</h3>
      <p>1A. 2F Lecturers</p>
      <p>5A. With 8A, despite the fact you doubted me on this at first 4 years ago...</p>
      <p>6A. What e = 2?</p>
      <p>8A. See 5A</p>
      <p>10A. Donned on body parts...</p>
      <h3>DOWN</h3>
      <p>1D. Fastened bands...</p>
      <p>2D. George and Ruthie's specialty</p>
      <p>3D. The beginning of knowledge...</p>
      <p>4D. What does a sender do?</p>
      <p>7D. You might well say this...</p>
      <p>9D. So you want to know 9D?... </p>
    </div>
  </div>

  <!-- Puzzle 3 -->
  <div id="puzzle3" class="hidden">
    <div class="clock" id="clock"></div>
    <button id="primeBtn" class="next-btn">Prime Time?</button>
    <div id="primeMessage"></div>
    <button id="next3" class="next-btn hidden">Next</button>
  </div>

  <!-- Puzzle 4 -->
  <div id="puzzle4" class="hidden">
    <div id="connect4">
      <div id="connect4-board"></div>
      <button id="reset4">Reset</button>
      <div id="haha">haha</div>
      <div id="c4Message"></div>
      <button id="next4" class="next-btn hidden">Next</button>
    </div>
  </div>

  <!-- Puzzle 5 -->
  <div id="puzzle5" class="hidden">
    <h2>Puzzle 5 coming soon</h2>
  </div>

<script>
/* --- Code Entry --- */
const codeInputs = [...document.querySelectorAll('.code-input')];
codeInputs.forEach((input, idx) => {
  input.addEventListener('input', () => {
    if (idx < codeInputs.length - 1 && input.value) codeInputs[idx + 1].focus();
    if (codeInputs.map(i => i.value.toUpperCase()).join('') === "JONES") {
      document.getElementById('codeEntry').classList.add('hidden');
      document.getElementById('puzzle1').classList.remove('hidden');
      initPuzzle1();
    }
  });
});

/* --- Puzzle 1: TicTacToe --- */
// (unchanged full tic-tac-toe logic omitted here for brevity â€” keep as in previous working version)

/* --- Puzzle 2: Crossword --- */
// (unchanged crossword generation/validation logic)

/* --- Puzzle 3: Prime Time --- */
function updateClock(){
  const now=new Date();
  const hh=now.getHours().toString().padStart(2,'0');
  const mm=now.getMinutes().toString().padStart(2,'0');
  document.getElementById("clock").textContent=`${hh} : ${mm}`;
}
setInterval(updateClock,1000);
updateClock();

function isPrime(n){return [2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59].includes(n);}

document.getElementById("primeBtn").addEventListener("click",()=>{
  const now=new Date();
  const h=now.getHours();
  const m=now.getMinutes();
  let msg="";
  /* ORIGINAL PRIME CHECK (uncomment to re-enable)
  if(!isPrime(h)) msg+=`${h} isn't prime<br>`;
  if(!isPrime(m)) msg+=`${m} isn't prime<br>`;
  if(msg===""){ 
    document.getElementById("next3").classList.remove("hidden");
  }
  */
  // TESTING OVERRIDE: always enable next
  document.getElementById("next3").classList.remove("hidden");
  document.getElementById("primeMessage").innerHTML=msg;
});
document.getElementById("next3").addEventListener("click",()=>{
  document.getElementById("puzzle3").classList.add("hidden");
  document.getElementById("puzzle4").classList.remove("hidden");
  initConnect4();
});

/* --- Puzzle 4: Connect 4 --- */
let c4Board, c4Current, c4GameOver, c4CpuFirstTurn;
function initConnect4(){
  const boardDiv=document.getElementById("connect4-board");
  boardDiv.innerHTML="";
  c4Board=Array.from({length:6},()=>Array(7).fill(null));
  c4Current="red"; // player
  c4GameOver=false;
  c4CpuFirstTurn=true;
  for(let r=0;r<6;r++){
    for(let c=0;c<7;c++){
      const cell=document.createElement("div");
      cell.className="c4-cell";
      cell.dataset.row=r;cell.dataset.col=c;
      boardDiv.appendChild(cell);
      cell.addEventListener("click",()=>playerMove(c));
    }
  }
  cpuMove(); // CPU starts
}
function playerMove(c){
  if(c4GameOver||c4Current!=="red") return;
  if(dropDisc(c,"red")){
    if(checkWin("red")){document.getElementById("c4Message").textContent="You win!";c4GameOver=true;document.getElementById("next4").classList.remove("hidden");return;}
    c4Current="yellow";
    setTimeout(cpuMove,500);
  }
}
function cpuMove(){
  if(c4GameOver) return;
  dropDisc(bestMove(),"yellow");
  if(checkWin("yellow")){document.getElementById("c4Message").textContent="CPU wins!";c4GameOver=true;return;}
  if(c4CpuFirstTurn && Math.random()<0.25){ // unfair double move chance
    dropDisc(bestMove(),"yellow");
    if(checkWin("yellow")){document.getElementById("c4Message").textContent="CPU wins!";c4GameOver=true;return;}
    let haha=document.getElementById("haha");
    haha.style.opacity=1;
    setTimeout(()=>{haha.style.opacity=0;},1000);
  }
  c4CpuFirstTurn=false;
  c4Current="red";
}
function dropDisc(col,color){
  for(let r=5;r>=0;r--){
    if(!c4Board[r][col]){
      c4Board[r][col]=color;
      const idx=r*7+col;
      document.getElementById("connect4-board").children[idx].classList.add(color==="red"?"c4-red":"c4-yellow");
      return true;
    }
  }
  return false;
}
function bestMove(){
  // trivial: pick random valid col
  let valid=[];for(let c=0;c<7;c++){if(!c4Board[0][c]) valid.push(c);}
  return valid[Math.floor(Math.random()*valid.length)];
}
function checkWin(color){
  for(let r=0;r<6;r++){for(let c=0;c<7;c++){
    if(c+3<7 && [0,1,2,3].every(i=>c4Board[r][c+i]===color)) return true;
    if(r+3<6 && [0,1,2,3].every(i=>c4Board[r+i][c]===color)) return true;
    if(r+3<6 && c+3<7 && [0,1,2,3].every(i=>c4Board[r+i][c+i]===color)) return true;
    if(r-3>=0 && c+3<7 && [0,1,2,3].every(i=>c4Board[r-i][c+i]===color)) return true;
  }}
  return false;
}
document.getElementById("reset4").addEventListener("click",initConnect4);
document.getElementById("next4").addEventListener("click",()=>{
  document.getElementById("puzzle4").classList.add("hidden");
  document.getElementById("puzzle5").classList.remove("hidden");
});
</script>
</body>
</html>
