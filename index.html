<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Puzzle</title>
<style>
  body {
    background: #000;
    color: #fff;
    margin: 0;
    font-family: sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  section { display: none; }
  section.active { display: flex; flex-direction: column; align-items: center; gap: 20px; }
  #code input {
    width: 50px; height: 60px;
    font-size: 2em; text-align: center;
    background: #111; border: none; color: #fff;
    text-transform: uppercase;
  }
  .board {
    display: grid;
    grid-template-columns: repeat(5, 80px);
    grid-template-rows: repeat(5, 80px);
    gap: 2px;
  }
  .cell {
    display: flex; align-items: center; justify-content: center;
    font-size: 2em; font-weight: bold;
    background: transparent; color: #fff;
    border: none; cursor: pointer;
  }
  .visible {
    background: #111;
  }
  .filled { cursor: default; }
  .outer {
    background: #000;
    pointer-events: none;
  }
  .outerEnabled .outer { pointer-events: auto; }
  button {
    padding: 10px 20px; background: #222; border: none; color: #fff;
    cursor: pointer; font-size: 1em;
  }
</style>
</head>
<body>

<section id="code" class="active">
  <div>
    <input maxlength="1"><input maxlength="1"><input maxlength="1"><input maxlength="1"><input maxlength="1">
  </div>
</section>

<section id="puzzle1">
  <div class="board" id="board"></div>
  <button id="reset">Reset</button>
</section>

<section id="puzzle2">
  <div style="width:200px;height:200px;background:#111;"></div>
</section>

<script>
const CODE = "JONES";
const codeInputs = document.querySelectorAll('#code input');
let codeIndex = 0;
codeInputs.forEach((input, idx) => {
  input.addEventListener('input', () => {
    input.value = input.value.toUpperCase().slice(0,1);
    if (idx < codeInputs.length-1 && input.value) codeInputs[idx+1].focus();
    checkCode();
  });
});
function checkCode() {
  const val = Array.from(codeInputs).map(i=>i.value).join('');
  if (val === CODE) showSection('puzzle1');
}

function showSection(id) {
  document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* --- Puzzle 1: Noughts and crosses --- */
const boardEl = document.getElementById('board');
let inner = Array(9).fill('');
let gameOver = false;
let outerEnabled = false;
let outerO = new Set();
const X = 'X', O = 'O';

function buildBoard() {
  boardEl.innerHTML = '';
  for (let r = 0; r < 5; r++) {
    for (let c = 0; c < 5; c++) {
      const isInner = r>=1 && r<=3 && c>=1 && c<=3;
      const idx3 = (r-1)*3 + (c-1);
      const btn = document.createElement('button');
      btn.className = 'cell ' + (isInner ? 'visible' : 'outer');
      btn.addEventListener('click', () => handleClick(r, c, isInner, idx3));
      boardEl.appendChild(btn);
    }
  }
  render();
}
function render() {
  const cells = boardEl.children;
  for (let r = 0; r < 5; r++) {
    for (let c = 0; c < 5; c++) {
      const idx = r*5+c;
      const cell = cells[idx];
      const isInner = r>=1 && r<=3 && c>=1 && c<=3;
      cell.textContent = '';
      if (isInner) {
        const idx3 = (r-1)*3 + (c-1);
        const v = inner[idx3];
        if (v) {
          cell.textContent = v;
          cell.classList.add('filled');
        } else {
          cell.classList.remove('filled');
        }
        cell.disabled = gameOver || v;
      }
    }
  }
  boardEl.classList.toggle('outerEnabled', outerEnabled);
}
function handleClick(r,c,isInner,idx3) {
  if (isInner && !gameOver) {
    if (inner[idx3]) return;
    inner[idx3] = O;
    render();
    if (checkWinner3(inner)) return finish3(checkWinner3(inner));
    cpuMove();
    render();
    if (checkWinner3(inner)) return finish3(checkWinner3(inner));
  } else if (!isInner && outerEnabled) {
    const key = `${r},${c}`;
    if (outerO.has(key)) return;
    outerO.add(key);
    if (checkOThreeInRow5()) {
      showSection('puzzle2');
    }
  }
}
function cpuMove() {
  const best = bestMove(inner, X);
  if (best.index !== -1) inner[best.index] = X;
}
const LINES_3 = [
  [0,1,2],[3,4,5],[6,7,8],
  [0,3,6],[1,4,7],[2,5,8],
  [0,4,8],[2,4,6]
];
function checkWinner3(b) {
  for (const [a,b1,c] of LINES_3) if (b[a] && b[a]===b[b1] && b[a]===b[c]) return b[a];
  if (b.every(v=>v)) return 'tie';
  return null;
}
function finish3(res) {
  gameOver = true;
  outerEnabled = (res === X || res === 'tie');
}
function bestMove(board, player) {
  const avail = board.map((v,i)=>v?null:i).filter(i=>i!==null);
  const winner = checkWinner3(board);
  if (winner === X) return {score: 10};
  if (winner === O) return {score: -10};
  if (winner === 'tie') return {score: 0};
  let best = { index: -1, score: player===X ? -Infinity : Infinity };
  for (const i of avail) {
    board[i] = player;
    const result = bestMove(board, player===X?O:X);
    board[i] = '';
    const score = result.score + (player===X ? -1 : 1);
    if (player===X) {
      if (score > best.score) best = { index: i, score };
    } else {
      if (score < best.score) best = { index: i, score };
    }
  }
  return best;
}
function buildOGrid5() {
  const g = Array.from({length:5},()=>Array(5).fill(false));
  for (let r=1; r<=3; r++) for (let c=1; c<=3; c++) {
    const idx3 = (r-1)*3+(c-1);
    if (inner[idx3]===O) g[r][c]=true;
  }
  outerO.forEach(k => {
    const [r,c] = k.split(',').map(Number);
    g[r][c]=true;
  });
  return g;
}
function checkOThreeInRow5() {
  const g = buildOGrid5();
  const dirs = [[0,1],[1,0],[1,1],[1,-1]];
  for (let r=0;r<5;r++) for (let c=0;c<5;c++) if (g[r][c])
    for (const [dr,dc] of dirs) {
      const r2=r+dr,c2=c+dc,r3=r+2*dr,c3=c+2*dc;
      if (g[r2]?.[c2] && g[r3]?.[c3]) return true;
    }
  return false;
}
function resetGame() {
  inner = Array(9).fill('');
  gameOver = false;
  outerEnabled = false;
  outerO.clear();
  cpuMove();
  render();
}
document.getElementById('reset').onclick = resetGame;
buildBoard();
resetGame();
</script>

</body>
</html>
