<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Sam</title>
<style>
  * { box-sizing: border-box; }
  html,body { height:100%; }
  body {
    background-color: #121212;
    color: #ffffff;
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 0;
    padding: 0;
  }

  .puzzle-section { display: none; margin-top: 20px; }

  .code-input {
    width: 40px; height: 40px;
    text-align: center; font-size: 24px; margin: 5px;
    background: #1e1e1e !important; color: #fff !important;
    border: 1px solid #333 !important; outline: none;
    text-transform: uppercase;
  }


  .outer-ring {
    display: grid;
    grid-template-columns: repeat(5, 60px);
    grid-gap: 2px;
    margin: 0 auto;
    justify-content: center;
    justify-items: center;
  }
  .outer-cell { width:60px; height:60px; background:transparent; display:flex; align-items:center; justify-content:center; font-size:32px; cursor:pointer; user-select:none; border:none; }
  .cell { width:60px; height:60px; background:#1e1e1e; display:flex; align-items:center; justify-content:center; font-size:32px; }
  .outer-cell.visibleO { background:#1e1e1e; color:#fff; }

  #result { font-size:24px; margin-top:12px; min-height:28px; }
  button { margin-top:12px; padding:10px 20px; font-size:16px; }

  #puzzle1 button {
    display: inline-block;
    margin: 0 10px;
    vertical-align: middle;
  }

  #puzzle2 .crossword { border-collapse:collapse; table-layout:fixed; margin:60px auto 12px auto; }
  #puzzle2 .crossword td { position:relative; width:40px; height:40px; border:1px solid #444 !important; padding:0; background:#111; }
  #puzzle2 .crossword td.black { background:#000 !important; }
  #puzzle2 .cw-cell { width:100%; height:100%; border:none; outline:none; text-align:center; font-size:20px; color:#000 !important; background:#fff !important; text-transform:uppercase; display:block; }
  #puzzle2 .cw-num { position:absolute; top:2px; left:2px; font-size:10px; color:#000; z-index:2; pointer-events:none; }
  #crossword-wrapper { display:flex; flex-direction:column; align-items:center; width:100%; }
  #crossword-clues { text-align:left; max-width:600px; margin:8px auto 24px auto; color:white; }

  #puzzle3 .clock-wrapper { margin-top:30px; display:flex; flex-direction:column; align-items:center; gap:12px; }
  #puzzle3 .clock { display:flex; align-items:center; gap:12px; font-family:inherit; color:white; font-size:48px; letter-spacing:2px; }
  #puzzle3 .half { display:flex; flex-direction:column; align-items:center; min-width:90px; }
  #puzzle3 .half .value { background:#1e1e1e; padding:8px 16px; border-radius:6px; min-width:60px; text-align:center; font-size:40px; color:white; }
  #puzzle3 .prime-btn { margin-top:8px; padding:8px 12px; font-size:14px; cursor:pointer; }
  #puzzle3 #next3 { display:none; margin-top:8px; }

  #puzzle4 .c4-wrapper { margin-top:20px; display:flex; flex-direction:column; align-items:center; gap:12px; }
  #puzzle4 .c4-board { display:grid; grid-template-columns: repeat(7, 56px); grid-gap:6px; background:transparent; padding:6px; }
  #puzzle4 .c4-cell { width: 60px; height: 60px; border-radius: 50%; background: #222; display: flex; align-items: center; justify-content: center; font-size: 40px; box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5); }
  #puzzle4 .disc { width:44px; height:44px; border-radius:50%; background:transparent; box-shadow: 0 1px 0 rgba(255,255,255,0.03) inset; }
  #puzzle4 .disc.player { background: #ffd54f; }
  #puzzle4 .disc.cpu { background: #ff6b6b; }
  #puzzle4 .c4-controls { display:flex; gap:8px; align-items:center; }
  #c4-status { margin-top:8px; min-height:24px; }
  #c4-reset { margin-left:8px; }

  .disabled { pointer-events: none; opacity: 0.7; }

  .connect4-board {
    display: grid;
    grid-template-columns: repeat(7, 60px);
    grid-template-rows: repeat(6, 60px);
    gap: 2px;
    justify-content: center;
    margin: 20px auto;
  }
  .haha {
    margin-top: 10px;
    color: red;
    opacity: 0;
    transition: opacity 1s;
  }

  .rainbow-link {
    font-size: 20px;
    text-decoration: underline;
    animation: rainbow 2s infinite;
  }

  @keyframes rainbow {
    0% { color: red; }
    16% { color: orange; }
    33% { color: yellow; }
    50% { color: green; }
    66% { color: blue; }
    83% { color: indigo; }
    100% { color: violet; }
  }

  #puzzle1 {
    text-align: center;
  }

  #puzzle1 button {
    display: block;
    margin: 10px auto;
  }
</style>
</head>
<body>

<div id="code-entry" class="puzzle-section" style="display:block;">
  <h1>Enter Code.</h1>
  <div>
    <input type="text" maxlength="1" class="code-input" id="code1">
    <input type="text" maxlength="1" class="code-input" id="code2">
    <input type="text" maxlength="1" class="code-input" id="code3">
    <input type="text" maxlength="1" class="code-input" id="code4">
    <input type="text" maxlength="1" class="code-input" id="code5">
  </div>
</div>

<!-- Puzzle 1 -->
<div id="puzzle1" class="puzzle-section">
  <h1>Win.</h1>
  <div id="outer-ring" class="outer-ring"></div>
  <div id="result"></div>
  <button id="reset-btn">Reset</button>
  <button id="next1" style="display:none;" onclick="showSection('puzzle2')">Next</button>
</div>

<!-- Puzzle 2 -->
<div id="puzzle2" class="puzzle-section">
    <h1>Solve.</h1>
  <div id="crossword-wrapper">
    <div id="crossword-container"></div>
    <button id="next2" style="display:none;" onclick="showSection('puzzle3')">Next</button>
  </div>

  <div id="crossword-clues">
    <h3>ACROSS</h3>
    <p>1A. 2F Lecturers.</p>
    <p>5A. With 8A, despite the fact you doubted me on this at first 4 years ago, the chance of choosing the door with the car behind it, if you choose to switch doors from your initial choice, where Monty doesn't know where the car is and resets the game if he reveals the car.</p>
    <p>6A. What e is 1?</p>
    <p>8A. See 5A.</p>
    <p>10A. Donned on body parts the same length as your forearms. Can be checked during Maths 2C lectures, apparently.</p>
    <h3>DOWN</h3>
    <p>1D. Fastened bands, strips of land, technique of loud vocalist.</p>
    <p>2D. George and Ruthie's specialty.</p>
    <p>3D. The beginning of knowledge...</p>
    <p>4D. What does a sender do?</p>
    <p>7D. You might well say this in satisfaction when solving this crossword.</p>
    <p>9D. So you want to know 9D? Well I've heard ( ln(S^2+2)^2 + ln(T^2+e)^2 + exp(U^2) + arctan(V)^2 + (abs(W)+1)^3 + sin(X)^2 + (R^2+K^2+D^2+1)^5 + 1 ) * (-1 - ((RK/D)^(1/2) - 4)) = 0. And writing the parameters in the solutions to these things alphabetically is so last year.</p>
  </div>
</div>

<!-- Puzzle 3 -->
<div id="puzzle3" class="puzzle-section">

  <div class="clock-wrapper" aria-live="polite">
    <div class="clock" id="clock">
      <div class="half" id="hour-half">
        <div class="value" id="hour-value">00</div>
      </div>

      <div style="font-size:40px;color:white;opacity:0.9;">:</div>

      <div class="half" id="minute-half">
        <div class="value" id="minute-value">00</div>
      </div>
    </div>

    <button id="primeCheckBtn" class="prime-btn">Prime Time?</button>
    <button id="next3" onclick="showSection('puzzle4')">Next</button>
  </div>
</div>

<!-- Puzzle 4 -->
<div id="puzzle4" class="puzzle-section">
  <h2>Win.</h2>
  <div class="connect4-board" id="c4Board"></div>
  <div id="c4Status" style="margin-top: 10px; font-size: 18px; color: white;"></div>
  <button id="c4Reset">Reset</button>
  <div id="haha" class="haha">haha</div>
  <button id="p4Next" class="hidden" onclick="showSection('puzzle5')">Next</button>
</div>

<!-- End Screen -->
<div id="puzzle5" class="puzzle-section">
  <h1>Congratulations!</h1>
  <p id="endMessage" style="margin: 20px; font-size: 18px; color: white;"></p>
</div>

<script>
function showSection(id) {
  document.querySelectorAll('.puzzle-section').forEach(sec => sec.style.display = 'none');
  const el = document.getElementById(id);
  el.style.display = 'block';
  if (id === 'puzzle1') startPuzzle1();
  if (id === 'puzzle2') buildCrossword();
  if (id === 'puzzle3') initPuzzle3();
  if (id === 'puzzle4') startConnect4();
  if (id === 'puzzle5') initEndScreen();
}

const codeInputs = document.querySelectorAll('.code-input');
codeInputs.forEach((input, index) => {
  input.addEventListener('input', () => {
    input.value = input.value.toUpperCase();
    if (input.value.length === 1 && index < codeInputs.length - 1) {
      codeInputs[index+1].focus();
    }
    checkCode();
  });
});
function checkCode(){
  const code = Array.from(codeInputs).map(i=>i.value.toUpperCase()).join('');
  if (code === 'JONES') {
    showSection('puzzle1');
  }
}

/* ---------- Puzzle 1 ---------- */
let outerRing = [];
let gameActive = true;
const innerToOuter = [6,7,8,11,12,13,16,17,18];
const winsOuter = [
  [6,7,8],[11,12,13],[16,17,18],
  [6,11,16],[7,12,17],[8,13,18],
  [6,12,18],[8,12,16]
];
const extendedTriplets = [
  [5,6,7],[7,8,9],
  [10,11,12],[12,13,14],
  [15,16,17],[17,18,19],
  [1,6,11],[11,16,21],
  [2,7,12],[12,17,22],
  [3,8,13],[13,18,23],
  [0,6,12],[12,18,24],
  [4,8,12],[12,16,20]
];
function startPuzzle1() {
  const outerRingContainer = document.getElementById('outer-ring');
  outerRingContainer.innerHTML = '';
  gameActive = true;
  outerRing = Array(25).fill(null);
  document.getElementById('result').textContent = '';
  document.getElementById('next1').style.display = 'none';
  for (let i=0;i<25;i++){
    const cell = document.createElement('div');
    cell.classList.add('outer-cell');
    if (innerToOuter.includes(i)) {
      cell.classList.add('cell');
      cell.addEventListener('click', ()=>handlePlayerMove(i));
    } else {
      cell.addEventListener('click', ()=>handleOuterClick(i));
    }
    outerRingContainer.appendChild(cell);
  }
  cpuMove();
}
function getInnerBoard(){ return innerToOuter.map(i=>outerRing[i]); }
function innerEmpty(b){ return b.every(v=>v===null); }
function winner3(b){ 
  const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  for (const [a,b2,c] of lines) if (b[a] && b[a]===b[b2] && b[a]===b[c]) return b[a];
  if (b.every(x=>x!==null)) return 'tie';
  return null;
}
function minimax(b,isMax,depth=0){
  const w = winner3(b);
  if (w==='X') return 10-depth;
  if (w==='O') return depth-10;
  if (w==='tie') return 0;
  if (isMax){
    let best=-Infinity;
    for (let i=0;i<9;i++) if (b[i]===null){ b[i]='X'; best=Math.max(best, minimax(b,false,depth+1)); b[i]=null; }
    return best;
  } else {
    let best=Infinity;
    for (let i=0;i<9;i++) if (b[i]===null){ b[i]='O'; best=Math.min(best, minimax(b,true,depth+1)); b[i]=null; }
    return best;
  }
}
function cpuMove(){
  if (!gameActive) return;
  const b = getInnerBoard();
  if (innerEmpty(b) && outerRing[12]===null) { makeMove(12,'X'); return; }
  let best=-Infinity, bestInner=null;
  for (let i=0;i<9;i++) if (b[i]===null){
    b[i]='X';
    const score = minimax(b,false,0);
    b[i]=null;
    if (score>best){ best=score; bestInner=i; }
  }
  if (bestInner!==null) makeMove(innerToOuter[bestInner],'X');
}
function makeMove(index,player){
  const cell = document.getElementById('outer-ring').children[index];
  if (!cell || outerRing[index]!==null) return;
  cell.textContent = player;
  if (player==='O') cell.classList.add('visibleO');
  outerRing[index]=player;
  if (innerToOuter.includes(index)){
    if (isWinInner(player)){ document.getElementById('result').textContent = player==='O' ? 'You Win!' : 'You Lose!'; gameActive=false; if (player==='O') document.getElementById('next1').style.display='block'; return; }
    if (isTieInner()){ document.getElementById('result').textContent='Tie!'; gameActive=false; return; }
  }
}
function handlePlayerMove(index){ if (!gameActive) return; if (outerRing[index]!==null) return; makeMove(index,'O'); if (gameActive) cpuMove(); }
function handleOuterClick(index){ if (gameActive) return; if (innerToOuter.includes(index)) return; if (outerRing[index]!==null) return; makeMove(index,'O'); if (isExtendedWinO()){ document.getElementById('result').textContent='You Win!'; document.getElementById('next1').style.display='block'; } }
function isWinInner(player){ return winsOuter.some(line=>line.every(i=>outerRing[i]===player)); }
function isTieInner(){ return innerToOuter.every(i=>outerRing[i]!==null); }
function isExtendedWinO(){ return extendedTriplets.some(tri=>tri.every(i=>outerRing[i]==='O')); }
document.getElementById('reset-btn').addEventListener('click', startPuzzle1);

/* ---------- Puzzle 2 ---------- */
function buildCrossword(){
  const container = document.getElementById('crossword-container');
  container.innerHTML='';
  const grid=[['B','E','L','K','S'],['E','*','O','N','E'],['L','O','G','*','N'],['T','H','I','R','D'],['S','O','C','K','S']];
  const numbers={'0,0':1,'0,2':2,'0,3':3,'0,4':4,'1,2':5,'2,0':6,'2,1':7,'3,0':8,'3,3':9,'4,0':10};
  const table=document.createElement('table'); table.className='crossword';
  for (let r=0;r<5;r++){ const tr=document.createElement('tr');
    for (let c=0;c<5;c++){ const td=document.createElement('td');
      if (grid[r][c]==='*') td.classList.add('black'); else { const input=document.createElement('input'); input.maxLength=1; input.className='cw-cell'; input.dataset.row=r; input.dataset.col=c; td.appendChild(input); }
      if (numbers[`${r},${c}`]){ const num=document.createElement('span'); num.className='cw-num'; num.textContent=numbers[`${r},${c}`]; td.appendChild(num); }
      tr.appendChild(td);
    }
    table.appendChild(tr);
  }
  container.appendChild(table);
  container.addEventListener('input', checkCrossword);
}
function checkCrossword(){
  const target=[['B','E','L','K','S'],['E','','O','N','E'],['L','O','G','','N'],['T','H','I','R','D'],['S','O','C','K','S']];
  let correct=true;
  document.querySelectorAll('#crossword-container .cw-cell').forEach(cell=>{
    const r=parseInt(cell.dataset.row,10), c=parseInt(cell.dataset.col,10);
    const expected=target[r][c]; const val=(cell.value||'').toUpperCase();
    if (val!==expected) correct=false;
  });
  if (correct) document.getElementById('next2').style.display='inline-block';
}

/* ---------- Puzzle 3 ---------- */
let puzzle3Interval = null;
const primesUnder60 = new Set([2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59]);

function initPuzzle3(){
  if (puzzle3Interval) clearInterval(puzzle3Interval);
  updateClock(); puzzle3Interval = setInterval(updateClock,1000);
  document.getElementById('next3').style.display='none';
  const btn = document.getElementById('primeCheckBtn');
  btn.onclick = checkPrimeTimeBoth;
}

function updateClock(){
  const now = new Date();
  const hh = now.getHours(), mm = now.getMinutes();
  document.getElementById('hour-value').textContent = String(hh).padStart(2,'0');
  document.getElementById('minute-value').textContent = String(mm).padStart(2,'0');
}

function isPrime(num) {
  return primesUnder60.has(num);
}

function checkPrimeTimeBoth() {
  const hourText = document.getElementById('hour-value').textContent;
  const minuteText = document.getElementById('minute-value').textContent;
  const hh = parseInt(hourText, 10);
  const mm = parseInt(minuteText, 10);

  const messages = [];
  if (!isPrime(hh)) messages.push(`${hourText} isn't prime.`);
  if (!isPrime(mm)) messages.push(`${minuteText} isn't prime.`);

  if (messages.length > 0) {
    alert(messages.join('\n'));
  } else {
    document.getElementById('next3').style.display = 'inline-block';
  }
}

/* ---------------- Puzzle 4 ---------------- */
function startConnect4() {
  const boardEl = document.getElementById("c4Board");
  const reset = document.getElementById("c4Reset");
  const next = document.getElementById("p4Next");
  const haha = document.getElementById("haha");
  const status = document.getElementById("c4Status");
  let board;
  let gameOver = false;
  let cheatCount = 0;
  const maxCheats = 4;

  function init() {
    board = Array(6).fill(null).map(() => Array(7).fill(""));
    boardEl.innerHTML = "";
    gameOver = false;
    cheatCount = 0;
    next.style.display = "none";
    status.textContent = "";
    for (let r = 0; r < 6; r++) {
      for (let c = 0; c < 7; c++) {
        const cell = document.createElement("div");
        cell.classList.add("c4-cell");
        cell.addEventListener("click", () => {
          if (!gameOver) playerMove(c);
        });
        boardEl.appendChild(cell);
      }
    }
    cpuMove();
  }

  function render() {
    for (let r = 0; r < 6; r++) {
      for (let c = 0; c < 7; c++) {
        const idx = r * 7 + c;
        const cell = boardEl.children[idx];
        const value = board[r][c];
        cell.textContent = ""; 
        cell.style.backgroundColor = ""; 
        if (value === "O") {
          cell.style.backgroundColor = "#ffd54f"; 
        } else if (value === "X") {
          cell.style.backgroundColor = "#ff6b6b"; 
        }
      }
    }
  }

  function drop(col, p) {
    for (let r = 5; r >= 0; r--) {
      if (board[r][col] === "") {
        board[r][col] = p;
        return true;
      }
    }
    return false;
  }

  function checkWin(p) {
    for (let r = 0; r < 6; r++) {
      for (let c = 0; c < 7; c++) {
        if (
          c + 3 < 7 &&
          [0, 1, 2, 3].every((i) => board[r][c + i] === p)
        )
          return true;
        if (
          r + 3 < 6 &&
          [0, 1, 2, 3].every((i) => board[r + i][c] === p)
        )
          return true;
        if (
          c + 3 < 7 &&
          r + 3 < 6 &&
          [0, 1, 2, 3].every((i) => board[r + i][c + i] === p)
        )
          return true;
        if (
          c - 3 >= 0 &&
          r + 3 < 6 &&
          [0, 1, 2, 3].every((i) => board[r + i][c - i] === p)
        )
          return true;
      }
    }
    return false;
  }

  function playerMove(col) {
    if (drop(col, "O")) {
      render();
      if (checkWin("O")) {
        gameOver = true;
        status.textContent = "You win!"; 
        next.style.display = "inline-block"; 
      } else cpuMove();
    }
  }

  function cpuMove() {
    if (gameOver) return;

    const bestMove = findBestMove();
    if (bestMove !== null) {
      drop(bestMove, "X");
      render();

      if (Math.random() < 0.3 && cheatCount < maxCheats) {
        cheatCount++;
        setTimeout(() => {
          const cheatCol = findCheatMove();
          if (cheatCol !== null) {
            drop(cheatCol, "X");
            render();
          }
        }, 200);
        haha.style.opacity = 1;
        setTimeout(() => {
          haha.style.opacity = 0;
        }, 1000);
      }

      if (checkWin("X")) {
        gameOver = true;
        status.textContent = "CPU wins!";
      }
    }
  }

  function findBestMove() {
    let bestScore = -Infinity;
    let bestCol = null;

    for (let col = 0; col < 7; col++) {
      if (board[0][col] === "") {
        drop(col, "X");
        const score = minimax(board, 0, false, -Infinity, Infinity);
        undoDrop(col);
        if (score > bestScore) {
          bestScore = score;
          bestCol = col;
        }
      }
    }

    return bestCol;
  }

  function findCheatMove() {
    for (let col = 0; col < 7; col++) {
      if (board[0][col] === "") {
        return col;
      }
    }
    return null;
  }

  function minimax(board, depth, isMaximizing, alpha, beta) {
    if (checkWin("X")) return 1000 - depth; 
    if (checkWin("O")) return depth - 1000; 
    if (isBoardFull()) return 0; 

    if (depth >= 5) return 0; 

    if (isMaximizing) {
      let maxEval = -Infinity;
      for (let col = 0; col < 7; col++) {
        if (board[0][col] === "") {
          drop(col, "X");
          const eval = minimax(board, depth + 1, false, alpha, beta);
          undoDrop(col);
          maxEval = Math.max(maxEval, eval);
          alpha = Math.max(alpha, eval);
          if (beta <= alpha) break; 
        }
      }
      return maxEval;
    } else {
      let minEval = Infinity;
      for (let col = 0; col < 7; col++) {
        if (board[0][col] === "") {
          drop(col, "O");
          const eval = minimax(board, depth + 1, true, alpha, beta);
          undoDrop(col);
          minEval = Math.min(minEval, eval);
          beta = Math.min(beta, eval);
          if (beta <= alpha) break; 
        }
      }
      return minEval;
    }
  }

  function isBoardFull() {
    return board[0].every(cell => cell !== "");
  }

  function undoDrop(col) {
    for (let r = 0; r < 6; r++) {
      if (board[r][col] !== "") {
        board[r][col] = "";
        break;
      }
    }
  }

  reset.onclick = init;
  init();
}

/* ---------- End Screen ---------- */
function initEndScreen() {
  const endMessage = document.getElementById('endMessage');

  const now = new Date();
  const birthdayEnd = new Date('2025-08-07T23:59:59');
  const graduationEnd = new Date('2025-07-02T16:00:00');

  const timeSinceBirthday = calculateTimeDifference(birthdayEnd, now);
  const timeSinceGraduation = calculateTimeDifference(graduationEnd, now);

  const message = `
    I would say happy birthday but we're ${timeSinceBirthday} late for that.
    And I would say happy end of uni but you graduated ${timeSinceGraduation} ago.
    So instead just... good job, <a href="https://youtu.be/DKP16d_WdZM?si=XefS5Cimp7d6nUhw" target="_blank" class="rainbow-link">Click here for your prize!</a>
  `;

  endMessage.innerHTML = message;
}

function calculateTimeDifference(startDate, endDate) {
  const diffMs = endDate - startDate;
  const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
  const diffHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));

  return `${diffDays} days, ${diffHours} hours, and ${diffMinutes} minutes`;
}
</script>
</body>
</html>
